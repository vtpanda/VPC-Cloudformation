{
  "AWSTemplateFormatVersion" : "2010-09-09",
  "Description": "NatGateway Instantiation for a VPC in US-East-1; Note that this is only IPv4",
  "Parameters": {
    "VPCName": {
      "Description": "Identifier to use for the VPC.",
      "Type": "String"
    }
  },
  "Resources": {
    "EIP1a": {
      "Type" : "AWS::EC2::EIP",
      "Properties" : {
      "Domain" : "vpc"
    }
  },
  "EIP1b": {
    "Type" : "AWS::EC2::EIP",
    "Properties" : {
    "Domain" : "vpc"
  }
},
  "NatGatewayUsEast1a": {
    "Type" : "AWS::EC2::NatGateway",
    "Properties" : {
      "AllocationId" : {
            "Fn::GetAtt" : ["EIP1a", "AllocationId"]
          },
      "SubnetId" : { "Fn::ImportValue": { "Fn::Sub": [ "Public-1a-${VPCName}", { "VPCName": {"Ref" : "VPCName" }} ]} },
      "Tags" : [ { "Key": "Name", "Value": { "Fn::Sub": [ "NATGateway-1a-${VPCName}", { "VPCName": {"Ref" : "VPCName" }} ]} } ]
    },
    "DependsOn": [ "EIP1a" ]
  },
  "NatGatewayUsEast1b": {
    "Type" : "AWS::EC2::NatGateway",
    "Properties" : {
      "AllocationId" : {
            "Fn::GetAtt" : ["EIP1b", "AllocationId"]
          },
      "SubnetId" : { "Fn::ImportValue": { "Fn::Sub": [ "Public-1b-${VPCName}", { "VPCName": {"Ref" : "VPCName" }} ]} },
      "Tags" : [ { "Key": "Name", "Value": { "Fn::Sub": [ "NATGateway-1b-${VPCName}", { "VPCName": {"Ref" : "VPCName" }} ]} } ]
    },
    "DependsOn": [ "EIP1b" ]
  },
  "PrivateRouteInternet1a": {
    "Type" : "AWS::EC2::Route",
    "Properties" : {
      "DestinationCidrBlock" : "0.0.0.0/0",
      "RouteTableId" : { "Fn::ImportValue": { "Fn::Sub": [ "RouteTable-Private-1a-${VPCName}", { "VPCName": {"Ref" : "VPCName" }} ]} },
      "NatGatewayId" : { "Ref" : "NatGatewayUsEast1a" }
      },
      "DependsOn": [ "NatGateway" ]
    },
    "PrivateRouteInternet1b": {
      "Type" : "AWS::EC2::Route",
      "Properties" : {
        "DestinationCidrBlock" : "0.0.0.0/0",
        "RouteTableId" : { "Fn::ImportValue": { "Fn::Sub": [ "RouteTable-Private-1b-${VPCName}", { "VPCName": {"Ref" : "VPCName" }} ]} },
        "NatGatewayId" : { "Ref" : "NatGatewayUsEast1b" }
        },
        "DependsOn": [ "NatGateway" ]
      },
    "PrivateNACLEntryHTTPOutboundInternet": {
      "Type" : "AWS::EC2::NetworkAclEntry",
      "Properties" : {
        "CidrBlock" : "0.0.0.0/0",
        "Egress" : true,
        "NetworkAclId" : { "Fn::ImportValue": { "Fn::Sub": [ "NACL-Private-${VPCName}", { "VPCName": {"Ref" : "VPCName" }} ]} },
        "PortRange" : {
          "From" : 80,
          "To" : 80
        },
        "Protocol" : 6,
        "RuleAction" : "allow",
        "RuleNumber" : 600
      }
    },
    "PrivateNACLEntryHTTPSOutboundInternet": {
      "Type" : "AWS::EC2::NetworkAclEntry",
      "Properties" : {
        "CidrBlock" : "0.0.0.0/0",
        "Egress" : true,
        "NetworkAclId" : { "Fn::ImportValue": { "Fn::Sub": [ "NACL-Private-${VPCName}", { "VPCName": {"Ref" : "VPCName" }} ]} },
        "PortRange" : {
          "From" : 443,
          "To" : 443
        },
        "Protocol" : 6,
        "RuleAction" : "allow",
        "RuleNumber" : 700
      }
    },
    "PrivateNACLEntryEphemeralInboundInternet": {
      "Type" : "AWS::EC2::NetworkAclEntry",
      "Properties" : {
        "CidrBlock" : "0.0.0.0/0",
        "Egress" : false,
        "NetworkAclId" : { "Fn::ImportValue": { "Fn::Sub": [ "NACL-Private-${VPCName}", { "VPCName": {"Ref" : "VPCName" }} ]} },
        "PortRange" : {
          "From" : 32768,
          "To" : 60999
        },
        "Protocol" : 6,
        "RuleAction" : "allow",
        "RuleNumber" : 800
      }
    }
  }
}
