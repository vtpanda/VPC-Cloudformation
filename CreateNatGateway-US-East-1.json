{
  "AWSTemplateFormatVersion" : "2010-09-09",
  "Description": "NatGateway Instantiation for a VPC in US-East-1; Note that this is only IPv4",
  "Parameters": {
    "VPCName": {
      "Description": "Identifier to use for the VPC.",
      "Type": "String"
    }
  },
  
  "Resources": {
    "EIP": {
      "Type" : "AWS::EC2::EIP",
      "Properties" : {
      "Domain" : "vpc"
    }
  },
  "NatGateway": {
    "Type" : "AWS::EC2::NatGateway",
    "Properties" : {
      "AllocationId" : { "Ref" : "EIP" },
      "SubnetId" : { "Fn::ImportValue": { "Fn::Sub": [ "VPC-${VPCName}", { "VPCName": {"Ref" : "VPCName" }} ]} },
      "Tags" : [ { "Key": "Name", "Value": { "Fn::Sub": [ "Public-us-east-1a-${VPCName}", { "VPCName": {"Ref" : "VPCName" }} ]} } ]
    },
    "DependsOn": [ "EIP" ]
  },
  "PrivateRouteInternet": {
    "Type" : "AWS::EC2::Route",
    "Properties" : {
      "DestinationCidrBlock" : "0.0.0.0/0",
      "RouteTableId" : { "Fn::ImportValue": { "Fn::Sub": [ "RouteTable-Public-${VPCName}", { "VPCName": {"Ref" : "VPCName" }} ]} },
      "NatGatewayId" : { "Ref" : "NatGateway" }
      },
      "DependsOn": [ "NatGateway" ]
    },
    "PrivateNACLEntryHTTPOutboundInternet": {
      "Type" : "AWS::EC2::NetworkAclEntry",
      "Properties" : {
        "CidrBlock" : "0.0.0.0/0",
        "Egress" : true,
        "NetworkAclId" : { "Fn::ImportValue": { "Fn::Sub": [ "NACL-Private-${VPCName}", { "VPCName": {"Ref" : "VPCName" }} ]} },
        "PortRange" : {
          "From" : 80,
          "To" : 80
        },
        "Protocol" : 6,
        "RuleAction" : "allow",
        "RuleNumber" : 600
      }
    },
    "PrivateNACLEntryHTTPSOutboundInternet": {
      "Type" : "AWS::EC2::NetworkAclEntry",
      "Properties" : {
        "CidrBlock" : "0.0.0.0/0",
        "Egress" : true,
        "NetworkAclId" : { "Fn::ImportValue": { "Fn::Sub": [ "NACL-Private-${VPCName}", { "VPCName": {"Ref" : "VPCName" }} ]} },
        "PortRange" : {
          "From" : 443,
          "To" : 443
        },
        "Protocol" : 6,
        "RuleAction" : "allow",
        "RuleNumber" : 600
      }
    },
    "PrivateNACLEntryEphemeralInboundInternet": {
      "Type" : "AWS::EC2::NetworkAclEntry",
      "Properties" : {
        "CidrBlock" : "0.0.0.0/0",
        "Egress" : false,
        "NetworkAclId" : { "Fn::ImportValue": { "Fn::Sub": [ "NACL-Private-${VPCName}", { "VPCName": {"Ref" : "VPCName" }} ]} },
        "PortRange" : {
          "From" : 32768,
          "To" : 60999
        },
        "Protocol" : 6,
        "RuleAction" : "allow",
        "RuleNumber" : 600
      }
    }
  }
}
